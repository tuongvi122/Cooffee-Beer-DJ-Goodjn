<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Coffee & Beer GooDjn</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Font Awesome cho hamburger icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      font-family: Arial, sans-serif;
      padding: 0;
      margin: 0;
      background-color: #f9f9f9;
      overflow-x: hidden; /* Th√™m d√≤ng n√†y */
    }
    #navbar-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%; /* Thay 100vw */
      z-index: 10000;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.09);
    }
    .site-content {
      flex: 1 0 auto;
      display: flex;
      flex-direction: column;
      padding-top: 64px;
      padding-bottom: 50px;  /* ho·∫∑c 60px n·∫øu c·∫ßn r·ªông h∆°n, t√πy chi·ªÅu cao footer */
    }
  #footer-container {
  background: #228B22;
  color: #fff;
  width: 100vw;
  min-height: 54px;
  height: 54px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1em;
  box-sizing: border-box;
  text-align: center;
  padding: 0 10px;
}
      #footer-container div {
      width: 100%;
      text-align: center;
      line-height: 1.15;
      word-break: break-word;
    }
    h2 { text-align: center; }
    #products {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    .product-card {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      width: 100%;
      max-width: 240px;
      text-align: center;
      box-sizing: border-box;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .product-card img { width: 100%; height: 320px; object-fit: cover; border-radius: 6px;aspect-ratio: 3/4; }
    .product-card .full-note { color: #d32f2f; font-weight: bold; font-size: 15px; margin-top: 5px; }
    .product-card.disabled { opacity: 0.65; pointer-events: none; }
    .ca-list { margin: 12px 0 0 0; padding: 0; list-style: none; }
    .ca-item-row { display: flex; align-items: center; gap: 0; margin-bottom: 5px; font-size: 15px; line-height: 1.4; width: 100%; box-sizing: border-box; }
    .ca-label { flex: 0 0 52px; text-align: left; font-weight: 500; color: #333; font-size: 15px; margin-right: 2px; white-space: nowrap; }
    .ca-price { flex: 1 1 70px; text-align: left; color: #086824; font-weight: 600; font-size: 15px; margin-right: 3px; min-width: 65px; max-width: 90px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .ca-checkbox { flex: 0 0 22px; margin-left: 0; margin-right: 0; align-self: center; transform: scale(1.1); display: inline-block; accent-color: #219a50; }
    .ca-remove-btn2 {
      flex: 0 0 auto;
      border: 2px solid #d32f2f;
      background: #d32f2f;
      color: #fff;
      font-weight: bold;
      font-size: 13px;
      padding: 2px 13px 2px 13px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      margin-left: 9px;
      white-space: nowrap;
      min-width: 0;
      width: auto;
      height: 28px;
      display: inline-block;
      box-sizing: border-box;
    }
    .ca-remove-btn2:disabled { opacity: 0.45; cursor: not-allowed; background: #f8bbbc; border-color: #e57373; color: #fff; }
    .ca-remove-btn2:hover:not(:disabled) { background: #b71c1c; border-color: #b71c1c; }
    .note-already-added { color: red; font-size: 13px; margin-left: 8px; min-width: 120px; display:inline-block; }
    .ca-busy-note { color: #d32f2f; font-size: 13px; font-weight: bold; margin-left: 7px; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    /* Popup to√†n trang - cu·ªôn body, trang ch√≠nh ph√≠a sau b·ªã kh√≥a cu·ªôn */
    body.modal-open {
      overflow: hidden;
      position: fixed;
      left: 0; right: 0;
      width: 100vw;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 99999 !important;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.3);
      overflow-y: auto;
    }
    .modal.show { display: block; }
    .modal-dialog {
      position: relative;
      width: 100vw;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      margin: 0;
    }
    .modal-content {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.20);
      width: 98vw;
      max-width: 430px;
      margin: 24px 0;
      position: relative;
      /* Kh√¥ng c√≥ overflow-y: auto, kh√¥ng c√≥ max-height */
    }
    .modal-header {
      padding: 15px 20px 0 20px;
      border-bottom: 1px solid #eee;
      border-radius: 10px 10px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
    }
    .modal-title { margin: 0; font-size: 21px;}
    .close { background: none; border: none; font-size: 28px; font-weight: bold; color: #888; cursor: pointer; line-height: 1;}
    .modal-body { padding: 15px 20px; }
    .alert { padding: 8px 12px; margin-bottom: 12px; border-radius: 5px; font-size: 14px; display: none;}
    .alert-danger { background: #ffd9d9; color: #a94442; border: 1px solid #f5c6cb;}
    .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb;}
    #order-thankyou { background: #daf7e1; color: #1e7e34; border: 1px solid #b7e4c7; padding: 12px; border-radius: 7px; text-align: center; font-weight: bold; font-size: 17px; margin-bottom: 10px; display: none;}
    table { width: 100%; border-collapse: collapse; margin-bottom: 10px;}
    th, td { padding: 8px; border: 1px solid #ddd; text-align: center;}
    .remove-btn, .remove-cart-btn { cursor: pointer; color: red; font-weight: bold; background: none; border: none; font-size: 18px;}
    input, textarea { width: 100%; margin: 5px 0; padding: 8px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;}
    .form-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px;}
    .confirm-btn { background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-size: 15px; cursor: pointer; transition: background-color 0.3s;}
    .confirm-btn:hover { background-color: #218838;}
    .close-btn { background-color: #999; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-size: 15px; cursor: pointer; transition: background-color 0.3s;}
    .close-btn:hover { background-color: #777;}
    #scrollToTopBtn { position: fixed; bottom: 20px; right: 10px; background-color: red; color: white; border: none; width: 30px; height: 30px; border-radius: 6px; font-size: 18px; line-height: 30px; text-align: center; cursor: pointer; display: none; z-index: 9999; box-shadow: 0 2px 8px rgba(0,0,0,0.3);}
    #floating-cart { position: fixed; top: 140px; right: 2px; background-color: #28a745; color: white; border: none; padding: 6px 10px; border-radius: 4px; font-size: 14px; cursor: pointer; z-index: 9999; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);}
    #tbl_carts th, #tbl_carts td { padding-top: 3px; padding-bottom: 3px; font-size: 15px; }
    #tbl_carts tr { height: 15px; }
    .product-card input[type="checkbox"]:disabled { filter: grayscale(80%); cursor: not-allowed;}
    #search-bar-area {
      position: fixed;
      right: 2px;
      top: 90px;
      z-index: 10002;
      display: flex;
      align-items: center;
      flex-direction: row;
      gap: 0;
    }
    #search-bar-area.hide { display: none !important; }
    #search-fab {
      width: 28px;
      height: 28px;
      background: #fff;
      color: #219a50;
      border: 2px solid #219a50;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 1px 8px rgba(0,0,0,0.13);
      transition: background 0.2s, color 0.2s;
      margin-bottom: 0;
      margin-right: 3px;
    }
    #search-fab:hover {
      background: #219a50;
      color: #fff;
    }
    #search-bar-wrapper {
      display: none;
      align-items: center;
      flex-direction: row;
      gap: 0;
      position: relative;
      z-index: 10003;
    }
    #search-bar {
      width: 175px;
      background: #fff;
      border: 1.8px solid #28a745;
      border-radius: 7px 0 0 7px;
      padding: 6px 10px;
      outline: none;
      font-size: 15px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.09);
      border-right: none;
    }
    #search-close {
      border: 1.8px solid #28a745;
      border-radius: 0 7px 7px 0;
      background: #f8d7da;
      color: #c82333;
      font-weight: bold;
      font-size: 15px;
      margin: 0;
      padding: 7px 13px 7px 9px;
      cursor: pointer;
      vertical-align: middle;
      border-left: none;
      transition: background 0.2s, color 0.2s;
      position: relative;
      left: -4px;
    }
    #search-close:hover { background: #c82333; color: #fff; }
    .marquee-flex-wrap {
      width: 100%;
      overflow: hidden;
      background: transparent;
      margin-top: 40px; /* ho·∫∑c padding-top: 40px; */
      margin: 10px 0 15px 0;
      height: 2.2em;
      position: relative;
    }
    .marquee-flex-text {
      display: inline-block;
      white-space: nowrap;
      font-size: 1.3em;
      color: #08810a;
      font-weight: bold;
      animation: slide-right 15s linear infinite;
    }
    @keyframes slide-right {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100vw);
      }
    }
    @media (max-width: 600px) {
      #products {
        display: grid !important;
        grid-template-columns: 1fr 1fr;
        gap: 12px 12px;
        margin-top: 13px;
        padding: 0 10px;
        box-sizing: border-box;
        justify-items: stretch;
        align-items: stretch;
      }
      .product-card {
        width: 100%;
        max-width: 150px;
        margin-bottom: 0;
        box-sizing: border-box;
      }
      .product-card img {
        height: 200px;   /* 173 x 0.66 ~ 115 (t·ª©c 1/2 m√†n h√¨nh, v·∫´n gi·ªØ t·ª∑ l·ªá 3:2) */
        border-radius: 5px;
        aspect-ratio: 3/4;
      }
    .form-buttons {
    display: flex !important;
    flex-direction: row !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 14px !important;
    margin-top: 22px;
    margin-bottom: 8px;
  }
    .form-buttons button {
    min-width: 110px !important;
    max-width: 180px !important;
    width: auto !important;
    flex: none !important;
  }
  .modal-dialog {
    max-width: 99vw !important;
    width: 99vw !important;
    margin: 0 auto !important;
    justify-content: center;
    align-items: center !important;
    min-height: 100vh !important;
    display: flex !important;
  }
   .modal-content {
    width: 95vw !important;
    max-width: 95vw !important;
    margin: 0 auto !important;
    padding-left: 10px;
    padding-right: 10px;
    box-sizing: border-box;
    /* TH√äM D√íNG D∆Ø·ªöI ƒê√ÇY */
    max-height: calc(100vh - 48px) !important;
    overflow-y: auto !important;
    overflow-x: hidden !important; /* Th√™m ƒë·ªÉ ngƒÉn tr√†n ngang */
  }
      .ca-item-row { flex-wrap: wrap; }
      .ca-remove-btn2 { margin-top: 4px; }
      #navbar-container { padding-top: 0; }

    .site-content {
    padding-bottom: 54px !important;
    min-height: 100vh;
    box-sizing: border-box;
  }

    #footer-container {
    min-height: 54px;
    font-size: 0.98em;
    padding: 0 7px;
    position: fixed;   /* N·∫øu mu·ªën Footer lu√¥n n·∫±m d∆∞·ªõi m√†n h√¨nh */
    bottom: 0;
    left: 0;
  }
  #footer-container div {
    width: 100%;
    text-align: center;
    line-height: 1.15;
    word-break: break-word;
  }
      .marquee-flex-wrap {
        margin: 4px 0 6px 0;
        height: auto !important;
        min-height: 0 !important;
        padding: 0;
      }
      .marquee-flex-text {
        font-size: 1em;
        padding: 0 5px;
      }
    }
    @media (max-width: 400px) {
      #products {
        grid-template-columns: 1fr 1fr;
        gap: 9px 5px;
      }
      .product-card { padding: 7px 3px; }
    }
    @media (max-width: 768px) {
      #navbar-container {
        padding: 0;
        min-height: 54px;
        height: 54px;
      }
  .mobile-navbar {
  position: relative;
  display: flex !important;
  align-items: center;
  width: 100vw;
  background: #228B22;
  min-height: 54px;
  height: 54px;
  z-index: 10001;
      }
      .mobile-navbar .hamburger {
        padding: 12px 12px 12px 7px;
        font-size: 27px;
        color: #fff;
        background: none;
        border: none;
        outline: none;
        margin-right: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
      }
      .mobile-navbar .navbar-title {
        flex: 1 1 70%;
        display: flex;
        flex-direction: column;
        line-height: 1.1;
        min-width: 0;
        white-space: nowrap;
        overflow: hidden;
      }
      .mobile-navbar .navbar-title .brand-main {
        color: #e1ba0a;
        font-weight: bold;
        font-size: 1.13em;
        line-height: 1.1;
        margin-bottom: 0;
      }
      .mobile-navbar .navbar-title .brand-sub {
        color: #e1ba0a;
        font-weight: bold;
        font-size: 0.99em;
        line-height: 1;
        margin-top: 0;
      }
  .mobile-navbar .mobile-hotline {
  position: absolute;
  top: 50%;
  right: 12px;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  background: #fff;
  border-radius: 30px;
  padding: 3px 16px 3px 11px;
  box-shadow: 0 0 5px #1113;
  height: 28px;
  font-size: 0.98em;
  white-space: nowrap;
  overflow: hidden;
  text-decoration: none !important;
}
      .mobile-navbar .mobile-hotline .hotline-number {
        font-size: 1.07em;
        margin-left: 3px;
        font-weight: bold;
        color: #0011ff;
        letter-spacing: 0.5px;
        text-decoration: none !important;
      }
      .mobile-navbar .mobile-hotline:link,
      .mobile-navbar .mobile-hotline:visited,
      .mobile-navbar .mobile-hotline:hover,
      .mobile-navbar .mobile-hotline:active {
        text-decoration: none !important;
      }
  .mobile-navbar-menu {
  display: none;
  position: fixed;
  top: 54px;
  left: 0;
  min-width: 180px;
  width: max-content;
  max-width: 92vw;
  background: #228B22;
  color: #fff;
  z-index: 12000;
  box-shadow: 2px 0 10px rgba(0,0,0,0.13);
  border-radius: 0 0 10px 0;
  padding: 0 0 16px 0;
  animation: slideInMenu 0.18s;
}
      .mobile-navbar-menu.open {
        display: block;
      }
      @keyframes slideInMenu {
        from { transform: translateX(-90%); opacity: 0.5; }
        to { transform: translateX(0); opacity: 1; }
      }
      .mobile-navbar-menu ul {
        list-style: none;
        margin: 0;
        padding: 10px 0 0 0;
      }
      .mobile-navbar-menu li {
        padding: 13px 0 9px 18px;
        font-size: 1.12em;
        cursor: pointer;
        font-weight: bold;
        border-bottom: 1px solid rgba(255,255,255,0.10);
        transition: background 0.1s;
      }
      .mobile-navbar-menu li:active,
      .mobile-navbar-menu li:hover {
        background: #1c6e1b;
      }
      .mobile-navbar-menu li:last-child { border-bottom: none; }
      .mobile-navbar-menu .logout-li { color: #fff; }
    }
    @media (max-width: 768px) {
      #navbar-container .desktop-navbar {
        display: none !important;
      }
    }
    @media (min-width: 769px) {
      .mobile-navbar, .mobile-navbar-menu { display: none !important; }
    }
  #popupLoading {
  display: none;
  position: absolute;
  left: 0; top: 0; right: 0; bottom: 0;
  background: rgba(255,255,255,0.8);
  z-index: 12000;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  font-size: 1.13em;
}
.popupLoadingInner {
  text-align: center;
  color: #117b26;
  font-size: 1.08em;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 13px;
}
.popupLoadingSpinner {
  width: 34px; height: 34px;
  border: 4px solid #b6ebc3;
  border-top: 4px solid #16c924;
  border-radius: 50%;
  animation: spinLoading 1s linear infinite;
}
@keyframes spinLoading {
  0% { transform: rotate(0deg);}
  100% { transform: rotate(360deg);}
}
#table-dropdown::-webkit-scrollbar { width: 6px; }
#table-dropdown::-webkit-scrollbar-thumb { background: #eee; border-radius: 5px; }
.table-dropdown-item { font-size: 15px; }
#note {
  width: 100%;
  margin-top: 7px;
  margin-bottom: 18px;
  padding: 8px;
  border-radius: 5px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  resize: vertical;
}
.form-buttons {
  margin-bottom: 18px !important;
}
#table-number-error {
  margin-bottom: 2px;
  display: block;
}
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <div id="navbar-container">
    <div class="mobile-navbar" style="display:none;">
      <button class="hamburger" id="hamburgerBtn" aria-label="M·ªü menu" tabindex="0">
        <i class="fa fa-bars"></i>
      </button>
      <a href="index.html" class="navbar-title" id="navbarTitleLink" style="text-decoration:none;">
        <span class="brand-main">Coffee & Beer</span>
        <span class="brand-sub">DJ GooDjn</span>
      </a>
      <a class="mobile-hotline" href="tel:0902926636">
        <i class="fa-solid fa-phone" style="color:#e53935"></i>
        <span class="hotline-number">0902 926 636</span>
      </a>
    </div>
    <nav class="mobile-navbar-menu" id="mobileMenu">
      <ul>
        <li data-href="index.html">ƒê·∫∑t d·ªãch v·ª•</li>
        <li data-href="danhgiakh.html">ƒê√°nh gi√° d·ªãch v·ª•</li>
      </ul>
    </nav>
    <div class="desktop-navbar"></div>
  </div>
  <script>
    fetch('navbar.html')
      .then(response => response.text())
      .then(html => { document.querySelector('#navbar-container .desktop-navbar').innerHTML = html; });

    document.addEventListener('DOMContentLoaded', function(){
      var hamburger = document.getElementById('hamburgerBtn');
      var menu = document.getElementById('mobileMenu');
      document.addEventListener('click', function(e){
        if (menu.classList.contains('open') && !menu.contains(e.target) && !hamburger.contains(e.target)) {
          menu.classList.remove('open');
        }
      });
      hamburger.onclick = function(e){
        e.stopPropagation();
        menu.classList.toggle('open');
      };
      menu.querySelectorAll('li').forEach(function(tab){
        tab.onclick = function(){
          menu.classList.remove('open');
          window.location.href = tab.getAttribute('data-href');
        };
      });
    });
  </script>
  <div class="site-content">
    <div class="marquee-flex-wrap">
      <div class="marquee-flex-text">
        Ch√†o m·ª´ng ƒë·∫øn v·ªõi Coffee & Beer DJ GooDjn!
      </div>
    </div>
    <div id="products"></div>
    <!-- Modal ƒë·∫∑t h√†ng - POPUP GI·ªé H√ÄNG -->
<div class="modal fade" id="modalOrder" tabindex="-1" role="dialog" aria-labelledby="modalOrderLabel" aria-hidden="true">
  <div class="modal-dialog mt-4">
    <div class="modal-content" style="position:relative;">
      <div class="modal-header">
        <h5 class="modal-title" id="modalOrderLabel">ƒê·∫∂T D·ªäCH V·ª§</h5>
        <button type="button" class="close" onclick="closeCartModal()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger" role="alert" id="alert_order"></div>
        <div class="alert alert-success" role="alert" id="alert_order_sucess"></div>
        <table id="tbl_carts" style="table-layout: fixed; width: 100%;">
            <thead>
              <tr>
              <th style="width: 20%;">M√£ NV</th>
              <th style="width: 25%;">ƒê∆°n gi√°</th>
              <th style="width: 15%;">Ca LV</th>
              <th style="width: 25%;">T·ªïng</th>
              <th style="width: 15%;">X√≥a</th>
              </tr>
            </thead>
              <tbody>
              </tbody>
        </table>
        <div id="order-total" style="text-align:right; font-weight:bold; margin-bottom:10px;"></div>
        <input placeholder="H·ªç v√† t√™n" id="name"><br>
        <input placeholder="S·ªë ƒëi·ªán tho·∫°i" id="phone" name="phone" type="tel" pattern="[0-9]{10,11}" maxlength="11" inputmode="numeric" autocomplete="tel" oninput="validatePhoneInput(this)"><br>
        <input placeholder="Email" id="contact"><br>
        <div style="position:relative;">
  <input id="table-number"
         autocomplete="off"
         placeholder="Ch·ªçn ho·∫∑c nh·∫≠p th·∫ª b√†n..."
         style="width:100%;margin:5px 0 0 0;padding:8px;border-radius:5px;border:1px solid #ccc;cursor:pointer;"
         onfocus="showTableDropdown()"
         oninput="handleTableInput()"
         onkeydown="handleTableKeyDown(event)">
  <div id="table-dropdown"
       style="display:none;position:absolute;z-index:999;width:100%;max-height:220px;overflow-y:auto;background:#fff;border:1px solid #aaa;border-radius:5px;box-shadow:0 2px 8px #0002;">
    <!-- Option s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
  </div>
  <span id="table-number-error" style="display:none;color:#d32f2f;font-size:13px;margin-bottom:2px;display:block;"></span>
</div>

<!-- ƒê·∫∑t textarea s√°t ngay d∆∞·ªõi input s·ªë b√†n, ƒë·ªìng b·ªô chi·ªÅu r·ªông, margin-top nh·ªè -->
<textarea placeholder="Ghi ch√∫" id="note" name="note"
  style="width:100%;margin-top:7px;margin-bottom:8px;padding:8px;border-radius:5px;border:1px solid #ccc;box-sizing:border-box;resize:vertical;"></textarea>
<div class="form-buttons" style="margin-bottom:8px;">
  <button class="confirm-btn" onclick="submitOrder()">ƒê·∫∑t d·ªãch v·ª•</button>
  <button class="close-btn" onclick="closeCartModal()">ƒê√≥ng</button>
</div>
      </div>
      <!-- ƒê·∫∑t overlay loading ngay cu·ªëi modal-content -->
      <div id="popupLoading">
        <div class="popupLoadingInner">
          <div class="popupLoadingSpinner"></div>
          <span>ƒêang g·ª≠i...</span>
        </div>
      </div>
    </div>
  </div>
</div>

    <button id="floating-cart" onclick="showCartModal()">Cart <span id="cart-count-floating">0</span> üõí</button>
    <button id="scrollToTopBtn" onclick="scrollToTop()">‚¨Ü</button>
    <div id="search-bar-area">
      <div id="search-fab" title="T√¨m ki·∫øm" onclick="showSearchBar()">
        <svg width="15" height="15" style="vertical-align:middle" viewBox="0 0 20 20">
          <circle cx="9" cy="9" r="6.5" stroke="#219a50" stroke-width="2" fill="none"/>
          <line x1="14" y1="14" x2="19" y2="19" stroke="#219a50" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div id="search-bar-wrapper">
        <input id="search-bar" type="text" placeholder="T√¨m M√£ NV ho·∫∑c Ca LV..." autocomplete="off" oninput="searchProductHandler(this.value)">
        <button id="search-close" onclick="closeSearchBar()" title="X√≥a t√¨m ki·∫øm">‚úï</button>
      </div>
    </div>
    <div class="modal fade" id="modalProductDetail" tabindex="-1" style="display:none;">
      <div class="modal-dialog mt-4">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Chi ti·∫øt s·∫£n ph·∫©m</h5>
            <button type="button" class="close" onclick="closeProductDetailModal()" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="modalProductDetailBody"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal x√°c nh·∫≠n ƒë·∫∑t d·ªãch v·ª• -->
  <div class="modal fade" id="confirmOrderModal" tabindex="-1" style="display:none;">
    <div class="modal-dialog mt-4">
      <div class="modal-content" style="max-width:350px;margin:auto;">
        <div class="modal-header">
          <h5 class="modal-title">X√°c nh·∫≠n ƒë·∫∑t d·ªãch v·ª•</h5>
          <button type="button" class="close" onclick="closeConfirmOrderModal()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" style="text-align:center;">
          B·∫°n c√≥ ch·∫Øc ƒë·∫∑t d·ªãch v·ª• n√†y kh√¥ng?
          <div class="form-buttons" style="margin-top:20px;">
            <button class="confirm-btn" id="confirmOrderYesBtn" onclick="handleOrderConfirm(true)">C√≥</button>
            <button class="close-btn" onclick="handleOrderConfirm(false)">Kh√¥ng</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Popup c·∫£m ∆°n ƒë·∫∑t d·ªãch v·ª• -->
<div class="modal fade" id="thankOrderModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog mt-4">
    <div class="modal-content" style="max-width:370px;margin:auto;text-align:center;">
      <div class="modal-header" style="justify-content:center;">
        <h5 class="modal-title" style="width:100%;color:#28a745;font-size:1.18em;font-weight:700;">
          C·∫£m ∆°n qu√Ω kh√°ch!
        </h5>
      </div>
      <div class="modal-body" style="padding:22px 16px 14px 16px;">
        <div style="font-size:1.06em;line-height:1.6;">
          C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ ƒë·∫∑t d·ªãch v·ª• t·∫°i<br>
          <b>Coffee & Beer DJ GooDjn</b>.<br>
          Ch√∫ng t√¥i s·∫Ω x√°c nh·∫≠n ƒë∆°n h√†ng v√† tr·∫£ k·∫øt qu·∫£ v·ªÅ Email c·ªßa b·∫°n.<br>
          <span style="color:#1976d2;font-size:0.98em;display:block;margin-top:8px;">
            M·ªçi th·∫Øc m·∫Øc vui l√≤ng li√™n h·ªá hotline:
          </span>
          <div style="color:#1976d2; font-size:1.18em; font-weight:bold; text-align:center; margin:2px 0 0 0;">
            <a href="tel:0902926636" style="color:#1976d2; text-decoration:none;"><b>0902 926 636</b></a>
          </div>
        </div>
        <button class="confirm-btn" onclick="closeThankOrderModal()" style="margin-top:18px;min-width:110px;">
          ƒê√≥ng
        </button>
      </div>
    </div>
  </div>
</div>
  <script>
    // Kh√≥a cu·ªôn trang ch√≠nh, popup cu·ªôn body nh∆∞ trang ch√≠nh
    let _bodyScrollY = 0;
    function lockBodyScroll() {
      _bodyScrollY = window.scrollY;
      document.body.classList.add('modal-open');
      document.body.style.top = `-${_bodyScrollY}px`;
    }
    function unlockBodyScroll() {
      document.body.classList.remove('modal-open');
      document.body.style.top = '';
      window.scrollTo(0, _bodyScrollY);
    }
    function openModalFix(modalid) {
      document.getElementById(modalid).classList.add('show');
      document.getElementById(modalid).style.display = 'block';
      lockBodyScroll();
    }
    function closeModalFix(modalid) {
      document.getElementById(modalid).classList.remove('show');
      document.getElementById(modalid).style.display = 'none';
      unlockBodyScroll();
    }
    // ...GI·ªÆ NGUY√äN TO√ÄN B·ªò JS PH√çA D∆Ø·ªöI (loadProducts, renderProducts, c√°c h√†m FE kh√°c)...
    let cart = [];
    let productsList = [];
    let employeeMap = {};
    let currentEmployeeMap = {};
    let lastSearchKey = "";
    let searchInputActive = false;
    let currentProductDetail = null;

    function formatCurrency(num) {
      return Number(num).toLocaleString('vi-VN') + "‚Ç´";
    }

    // --- T·ª± ƒë·ªông reload s·∫£n ph·∫©m sau m·ªói 60s (ƒë·ªÉ lu√¥n c·∫≠p nh·∫≠t tr·∫°ng th√°i m·ªõi nh·∫•t) ---
    let reloadProductsInterval = null;
    function startAutoReloadProducts() {
      if (reloadProductsInterval) clearInterval(reloadProductsInterval);
      reloadProductsInterval = setInterval(loadProducts, 60000);
    }
    async function loadProducts() {
  try {
    const { products, availableTables: tables } = await fetch('/api/getProducts').then(r => r.json());
    productsList = products;
    availableTables = Array.isArray(tables) ? tables : [];
    if (!Array.isArray(productsList) || productsList.length === 0) {
      document.getElementById('products').innerHTML = '<div style="color:red;text-align:center;width:100%;">Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu s·∫£n ph·∫©m! H√£y ki·ªÉm tra API ho·∫∑c d·ªØ li·ªáu Google Sheets!</div>';
      return;
    }
    employeeMap = groupByEmployee(productsList);
    currentEmployeeMap = employeeMap;
    renderProducts(currentEmployeeMap);
  } catch (e) {
    document.getElementById('products').innerHTML = '<div style="color:red;text-align:center;width:100%;">L·ªói l·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m: ' + e + '</div>';
  }
}

    // Gom nh√≥m s·∫£n ph·∫©m theo m√£ NV
    function groupByEmployee(products) {
      const map = {};
      products.forEach(prod => {
        map[prod.maNV] = {
          linkAnhNV: prod.linkAnhNV || "",
          caList: prod.caList || [],
          isFull: prod.allCaFull || false
        };
      });
      return map;
    }

    // Hi·ªÉn th·ªã danh s√°ch th·∫ª s·∫£n ph·∫©m
    function renderProducts(empMap) {
  const container = document.getElementById('products');
  let html = '';
  Object.entries(empMap).forEach(([maNV, emp]) => {
    // N·∫øu B·∫§T K·ª≤ ca n√†o c·ªßa m√£ NV n√†y c√≥ daFull = "ƒê√£ full" th√¨ disable to√†n b·ªô th·∫ª
    let isFull = emp.caList.some(ca => ca.daFull === "ƒê√£ full");
    let cardClass = isFull ? "product-card disabled" : "product-card";
    html += `
      <div class="${cardClass}" id="card_${maNV}" style="cursor:${isFull ? 'not-allowed' : 'pointer'}" ${isFull ? '' : `onclick="showProductDetail('${maNV}')"`}>
        <img src="${emp.linkAnhNV && emp.linkAnhNV.length > 10 ? emp.linkAnhNV : 'https://via.placeholder.com/260x173?text=' + maNV}" alt="·∫¢nh s·∫£n ph·∫©m" loading="lazy">
        <div style="font-weight: bold; margin-top: 8px; font-size: 20px;">${maNV}</div>
        ${isFull ? `<div class="full-note">ƒê√£ full</div>` : ""}
      </div>
    `;
  });
  container.innerHTML = html;
}

    function isCaInCart(maNV, caLV) {
      return cart.some(item => item.maNV === maNV && item.caLV === caLV);
    }

    // Hi·ªÉn th·ªã popup chi ti·∫øt s·∫£n ph·∫©m
    function showProductDetail(maNV) {
      currentProductDetail = maNV;
      const emp = currentEmployeeMap[maNV];
      if (!emp) return;
      window._popupTempChecked = {};

      let html = `
        <div style="text-align:center;">
        <img src="${emp.linkAnhNV && emp.linkAnhNV.length > 10 ? emp.linkAnhNV : 'https://via.placeholder.com/260x173?text=' + maNV}" alt="·∫¢nh s·∫£n ph·∫©m" class="popup-emp-img">  
        </div>
        <ul class="ca-list" style="margin-top:18px;">
      `;
      emp.caList.forEach((ca, idx) => {
        // ·∫®n ca n·∫øu ngh·ªâ ph√©p/ngh·ªâ vi·ªác
        if (ca.trangThai !== "L√†m vi·ªác") return;
        const idCheckbox = `modal_ck_${maNV}_${ca.caLV}`;
        const isLocked = isCaInCart(maNV, ca.caLV);
        const isBusy = ca.dangBan === "ƒêang b·∫≠n";
        html += `
          <li class="ca-item-row" data-ma-nv="${maNV}" data-ca-lv="${ca.caLV}">
            <span class="ca-label">Ca ${ca.caLV}:</span>
            <span class="ca-price">${formatCurrency(ca.donGia)}</span>
            <input type="checkbox" class="ca-checkbox" id="${idCheckbox}" 
              data-ma-nv="${maNV}" data-ca-lv="${ca.caLV}" data-don-gia="${ca.donGia}"
              ${isLocked ? "checked disabled" : ""}
              ${isBusy ? "disabled" : ""}
              onchange="popupCaCheckboxChange(this)">
            ${isBusy ? `<span class="ca-busy-note">ƒêang b·∫≠n vi·ªác</span>` : ""}
            <button class="ca-remove-btn2" onclick="removeCaFromCartModal('${maNV}','${ca.caLV}')" style="${isLocked ? '' : 'display:none'};margin-left:7px;">X√≥a</button>
            ${isLocked ? `<span class="note-already-added" style="margin-left:7px;">Ca ${ca.caLV} ƒë√£ c√≥ trong gi·ªè h√†ng</span>` : ""}
          </li>
        `;
      });

      html += `</ul>
        <div class="form-buttons" style="margin-top:24px;">
          <button class="confirm-btn" onclick="addModalCheckedItems('${maNV}')">Th√™m v√†o gi·ªè</button>
          <button class="close-btn" onclick="closeProductDetailModal()">ƒê√≥ng</button>
        </div>
      `;

      document.getElementById('modalProductDetailBody').innerHTML = html;
      document.getElementById('modalProductDetail').classList.add('show');
      document.getElementById('modalProductDetail').style.display = 'block';
      window._popupTempChecked = {};
    }

    function popupCaCheckboxChange(cb) {
      const maNV = cb.getAttribute('data-ma-nv');
      const caLV = cb.getAttribute('data-ca-lv');
      if (cb.disabled) return;
      window._popupTempChecked = window._popupTempChecked || {};
      window._popupTempChecked[caLV] = cb.checked;
    }

    function addModalCheckedItems(maNV) {
      window._popupTempChecked = window._popupTempChecked || {};
      const emp = currentEmployeeMap[maNV];
      if (!emp) return;
      let isAdded = false;
      emp.caList.forEach((ca) => {
        if (ca.trangThai !== "L√†m vi·ªác") return;
        if (window._popupTempChecked[ca.caLV] && !isCaInCart(maNV, ca.caLV)) {
          cart.push({ maNV, caLV: ca.caLV, donGia: ca.donGia });
          isAdded = true;
        }
      });
      showProductDetail(maNV);
      updateCartCount();
    }

    function removeCaFromCartModal(maNV, caLV) {
      const idx = cart.findIndex(item => item.maNV === maNV && item.caLV === caLV);
      if (idx !== -1) cart.splice(idx, 1);
      showProductDetail(maNV);
      updateCartCount();
    }

    function closeProductDetailModal() {
      document.getElementById('modalProductDetail').classList.remove('show');
      document.getElementById('modalProductDetail').style.display = 'none';
      currentProductDetail = null;
    }

    function refreshProductDetailIfOpen() {
      if (currentProductDetail && document.getElementById('modalProductDetail').style.display === 'block') {
        showProductDetail(currentProductDetail);
      }
    }

    function updateCartCount() {
      document.getElementById('cart-count-floating').innerText = cart.length;
    }

    function removeFromCart(index) {
      if (index >= 0 && index < cart.length) {
        cart.splice(index, 1);
        renderCartTable();
        updateCartCount();
        refreshProductDetailIfOpen();
      }
    }

    function renderCartTable() {
      const tbody = document.querySelector('#tbl_carts tbody');
      tbody.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
        const sub = item.donGia;
        total += sub;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.maNV}</td>
          <td>${formatCurrency(item.donGia)}</td>
          <td>${item.caLV}</td>
          <td>${formatCurrency(sub)}</td>
          <td><button class="remove-cart-btn" title="Remove" onclick="removeFromCart(${index})">üóëÔ∏è</button></td>
        `;
        tbody.appendChild(row);
      });
      document.getElementById('order-total').innerHTML = "T·ªïng c·ªông: " + formatCurrency(total);
    }

  async function showCartModal() {
  loadProducts();
  renderCartTable();
  document.getElementById('alert_order').style.display = 'none';
  document.getElementById('alert_order_sucess').style.display = 'none';
  document.getElementById('modalOrder').classList.add('show');
  document.getElementById('modalOrder').style.display = 'block';
  document.getElementById('floating-cart').style.display = 'none';
  document.getElementById('scrollToTopBtn').style.display = 'none';
  document.getElementById('search-bar-area').classList.add('hide');
  let info = localStorage.getItem("customerInfo");
  if (info) {
    try {
      const { name, phone, contact } = JSON.parse(info);
      if(name) document.getElementById('name').value = name;
      if(phone) document.getElementById('phone').value = phone;
      if(contact) document.getElementById('contact').value = contact;
    } catch(e) {}
  }
  closeSearchBar();
  // Reset c√°c tr∆∞·ªùng "S·ªë b√†n" v√† "Ghi ch√∫" v·ªÅ r·ªóng m·ªói l·∫ßn m·ªü form:
  await renderTableNumberOptionsVirtual();
  resetTableInput();
  document.getElementById('note').value = '';
  document.getElementById('table-number').value = '';
  // ---- Enable l·∫°i n√∫t ----
  document.querySelector('#modalOrder .confirm-btn').disabled = false;
  document.querySelector('#modalOrder .close-btn').disabled = false;
}
    function closeCartModal() {
      document.getElementById('modalOrder').classList.remove('show');
      document.getElementById('modalOrder').style.display = 'none';
      document.getElementById('floating-cart').style.display = '';
      document.getElementById('search-bar-area').classList.remove('hide');
      if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
        document.getElementById('scrollToTopBtn').style.display = 'block';
      } else {
        document.getElementById('scrollToTopBtn').style.display = 'none';
      }
    }

    function validatePhoneInput(input) {
      // Gi·ªØ l·∫°i ch·ªâ s·ªë v√† t·ªëi ƒëa 11 s·ªë
      input.value = input.value.replace(/[^0-9]/g, '').slice(0, 11);
    }
    // ƒêo·∫°n x·ª≠ l√Ω x√°c nh·∫≠n ƒë·∫∑t d·ªãch v·ª• v√† c·∫£m ∆°n
    function submitOrder() {
      if (!validateTableNumber()) return;
      document.getElementById('confirmOrderModal').classList.add('show');
      document.getElementById('confirmOrderModal').style.display = 'block';
    }
    function closeConfirmOrderModal() {
      document.getElementById('confirmOrderModal').classList.remove('show');
      document.getElementById('confirmOrderModal').style.display = 'none';
    }
    function showThankOrderModal() {
      document.getElementById('thankOrderModal').classList.add('show');
      document.getElementById('thankOrderModal').style.display = 'block';
    }
    function closeThankOrderModal() {
      document.getElementById('thankOrderModal').classList.remove('show');
      document.getElementById('thankOrderModal').style.display = 'none';
    }
async function handleOrderConfirm(yes) {
  if (!yes) {
    closeConfirmOrderModal();
    return;
  }
  // Disable n√∫t trong popup ƒë·∫∑t d·ªãch v·ª•
  document.querySelector('.confirm-btn[onclick="submitOrder()"]').disabled = true;
  document.querySelector('.close-btn[onclick="closeCartModal()"]').disabled = true;

  // Show loading overlay (ph·ªß l√™n form)
  document.getElementById('popupLoading').style.display = 'flex';

  closeConfirmOrderModal();

  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const contact = document.getElementById('contact').value.trim();
  const note = document.getElementById('note').value.trim();
  const tableNum = document.getElementById('table-number').value.trim();
  const alertOrder = document.getElementById('alert_order');
  const alertSuccess = document.getElementById('alert_order_sucess');

  alertOrder.style.display = 'none';
  alertSuccess.style.display = 'none';

  if (!name || !phone || !contact || !tableNum) {
    alertOrder.innerText = "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç v√† t√™n, S·ªë ƒëi·ªán tho·∫°i, Email, S·ªë th·∫ª b√†n";
    alertOrder.style.display = 'block';
    enableOrderButtons();
    document.getElementById('popupLoading').style.display = 'none'; // Hide overlay
    return;
  }
  if (!/^[0-9]{10,11}$/.test(phone)) {
    alertOrder.innerText = "S·ªë ƒëi·ªán tho·∫°i ph·∫£i g·ªìm 10 ho·∫∑c 11 s·ªë.";
    alertOrder.style.display = 'block';
    enableOrderButtons();
    document.getElementById('popupLoading').style.display = 'none'; // Hide overlay
    return;
  }
  if (cart.length === 0) {
    alertOrder.innerText = "Gi·ªè h√†ng tr·ªëng ch∆∞a c√≥ s·∫£n ph·∫©m!";
    alertOrder.style.display = 'block';
    enableOrderButtons();
    document.getElementById('popupLoading').style.display = 'none'; // Hide overlay
    return;
  }
  const order = { name, phone, contact, tableNum, note, items: cart };
  try {
    const result = await fetch('/api/submitOrder', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(order)
    }).then(r => r.json());

    if (result && result.success) {
      localStorage.setItem("customerInfo", JSON.stringify({ name, phone, contact }));
      cart = [];
      document.getElementById('cart-count-floating').innerText = '0';
      renderProducts(currentEmployeeMap);
      refreshProductDetailIfOpen();

      // ƒê√ìNG FORM GI·ªé H√ÄNG tr∆∞·ªõc khi m·ªü c·∫£m ∆°n
      closeCartModal();

      // ·∫®N LOADING r·ªìi hi·ªán popup c·∫£m ∆°n
      setTimeout(function() {
        document.getElementById('popupLoading').style.display = 'none';
        showThankOrderModal();
      }, 300); // 300ms ƒë·ªÉ hi·ªáu ·ª©ng m∆∞·ª£t, c√≥ th·ªÉ ch·ªânh th√†nh 0 n·∫øu mu·ªën
    } else {
      alertOrder.innerText = "C√≥ l·ªói x·∫£y ra khi g·ª≠i ƒë∆°n h√†ng. Vui l√≤ng th·ª≠ l·∫°i.";
      alertOrder.style.display = 'block';
      enableOrderButtons();
      document.getElementById('popupLoading').style.display = 'none';
    }
  } catch (e) {
    alertOrder.innerText = "L·ªói k·∫øt n·ªëi: " + e;
    alertOrder.style.display = 'block';
    enableOrderButtons();
    document.getElementById('popupLoading').style.display = 'none';
  }
}

function enableOrderButtons() {
  document.querySelector('.confirm-btn[onclick="submitOrder()"]').disabled = false;
  document.querySelector('.close-btn[onclick="closeCartModal()"]').disabled = false;
  const yesBtn = document.getElementById('confirmOrderYesBtn');
  if (yesBtn) yesBtn.disabled = false;
}

    window.onscroll = function () {
      const btn = document.getElementById("scrollToTopBtn");
      if (btn) {
        btn.style.display = (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) ? "block" : "none";
      }
    };

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showSearchBar() {
      document.getElementById('search-bar-wrapper').style.display = 'flex';
      document.getElementById('search-bar').focus();
    }

    function closeSearchBar() {
      document.getElementById('search-bar-wrapper').style.display = 'none';
      document.getElementById('search-bar').value = '';
      searchInputActive = false;
      applyProductSearchFilter('');
    }

    function searchProductHandler(val) {
      val = val || "";
      searchInputActive = val.trim().length > 0;
      applyProductSearchFilter(val);
    }

    function applyProductSearchFilter(keyword) {
      lastSearchKey = keyword = (keyword || "").trim().toLowerCase();
      if (!keyword) {
        currentEmployeeMap = employeeMap;
      } else {
        let filteredEmployeeMap = {};
        let caMatchList = [];
        const caRegex = /ca\s*([0-9]+)/g;
        let m;
        while ((m = caRegex.exec(keyword)) !== null) {
          caMatchList.push(m[1].replace(/^0+/,''));
        }
        keyword = keyword.replace(/ca\s*[0-9]+/g, "");
        keyword = keyword.trim();

        Object.entries(employeeMap).forEach(([maNV, emp]) => {
          const matchNV = keyword && maNV.toLowerCase().includes(keyword);
          let caList = emp.caList;
          if (caMatchList.length > 0) {
            caList = caList.filter(
              ca => caMatchList.includes(ca.caLV.replace(/^0+/, ""))
            );
          }
          if (keyword) {
            caList = caList.filter(
              ca =>
                matchNV ||
                maNV.toLowerCase().includes(keyword) ||
                ca.caLV.toLowerCase().includes(keyword)
            );
          }
          if (matchNV || caList.length) {
            filteredEmployeeMap[maNV] = {
              linkAnhNV: emp.linkAnhNV,
              caList,
              isFull: emp.isFull
            };
          }
        });
        currentEmployeeMap = filteredEmployeeMap;
      }
      renderProducts(currentEmployeeMap);
    }

    window.applyProductSearchFilter = applyProductSearchFilter;
    window.popupCaCheckboxChange = popupCaCheckboxChange;
    window.removeCaFromCartModal = removeCaFromCartModal;
    window.addModalCheckedItems = addModalCheckedItems;
    window.showProductDetail = showProductDetail;
    window.closeProductDetailModal = closeProductDetailModal;
    window.removeFromCart = removeFromCart;
    window.showCartModal = showCartModal;
    window.closeCartModal = closeCartModal;
    window.submitOrder = submitOrder;
    window.scrollToTop = scrollToTop;
    window.validatePhoneInput = validatePhoneInput;
    window.showSearchBar = showSearchBar;
    window.closeSearchBar = closeSearchBar;
    window.searchProductHandler = searchProductHandler;
    window.refreshProductDetailIfOpen = refreshProductDetailIfOpen;

    window.onload = () => {
      loadProducts();
      startAutoReloadProducts();
    };

    document.addEventListener('click', function(e){
      const fab = document.getElementById('search-fab');
      const wrapper = document.getElementById('search-bar-wrapper');
      if (wrapper && wrapper.style.display === 'flex' && !wrapper.contains(e.target) && !fab.contains(e.target)) {
        if (!document.getElementById('search-bar').value.trim()) {
          closeSearchBar();
        }
      }
    });
  let availableTables = [];
let filteredTables = [];
let tableDropdownPage = 0;
const TABLES_PER_PAGE = 10;

// L·∫•y b√†n kh·∫£ d·ª•ng v√† reset l·ªçc
async function renderTableNumberOptionsVirtual() {
  // availableTables ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t khi g·ªçi loadProducts, kh√¥ng c·∫ßn fetch l·∫°i t·ª´ API
  filteredTables = [...availableTables];
  tableDropdownPage = 0;
  renderTableDropdownPage();
}

// Khi focus ho·∫∑c click v√†o input
function showTableDropdown() {
  const dropdown = document.getElementById('table-dropdown');
  dropdown.style.display = 'block';
  if (dropdown.innerHTML === '') {
    tableDropdownPage = 0;
    renderTableDropdownPage();
  }
  dropdown.onscroll = function() {
    if (dropdown.scrollTop + dropdown.clientHeight >= dropdown.scrollHeight - 30) {
      if ((tableDropdownPage + 1) * TABLES_PER_PAGE < filteredTables.length) {
        tableDropdownPage += 1;
        renderTableDropdownPage();
      }
    }
  };
  document.addEventListener('mousedown', hideDropdownIfClickedOutside);
}

// Khi nh·∫≠p input s·ªë b√†n
function handleTableInput() {
  const value = document.getElementById('table-number').value.trim();
  if (value) {
    filteredTables = availableTables.filter(t => t.toString().includes(value));
  } else {
    filteredTables = [...availableTables];
  }
  tableDropdownPage = 0;
  renderTableDropdownPage();
  validateTableNumber();
}

// Khi nh·∫•n Enter
function handleTableKeyDown(event) {
  if (event.key === "Enter") {
    const input = document.getElementById('table-number');
    const value = Number(input.value.trim());
    if (filteredTables.includes(value)) {
      input.value = value;
      document.getElementById('table-dropdown').style.display = 'none';
      validateTableNumber();
    } else {
      // N·∫øu nh·∫≠p s·ªë kh√¥ng h·ª£p l·ªá, v·∫´n ƒë√≥ng dropdown nh∆∞ng s·∫Ω b√°o l·ªói
      document.getElementById('table-dropdown').style.display = 'none';
      validateTableNumber();
    }
  }
}

// Render 10 b√†n/l·∫ßn
function renderTableDropdownPage() {
  const dropdown = document.getElementById('table-dropdown');
  if (!dropdown) return;
  const start = tableDropdownPage * TABLES_PER_PAGE;
  const end = Math.min(start + TABLES_PER_PAGE, filteredTables.length);
  let html = '';
  for (let i = start; i < end; ++i) {
    html += `<div class="table-dropdown-item"
      data-table="${filteredTables[i]}"
      style="padding:8px 16px;cursor:pointer;">
    Th·∫ª b√†n s·ªë ${filteredTables[i]}
    </div>`;
  }
  if (tableDropdownPage === 0) dropdown.innerHTML = html;
  else dropdown.innerHTML += html;

  // G√°n s·ª± ki·ªán click
  dropdown.querySelectorAll('.table-dropdown-item').forEach(opt => {
    opt.onclick = () => {
      const tableInput = document.getElementById('table-number');
      tableInput.value = opt.getAttribute('data-table');
      dropdown.style.display = 'none';
      validateTableNumber();
    };
    opt.onmouseover = () => { opt.style.background = "#f5f5f5"; };
    opt.onmouseout = () => { opt.style.background = "#fff"; };
  });
}

// ƒê√≥ng dropdown khi click ngo√†i input/dropdown
function hideDropdownIfClickedOutside(e) {
  const dropdown = document.getElementById('table-dropdown');
  const input = document.getElementById('table-number');
  if (!dropdown.contains(e.target) && e.target !== input) {
    dropdown.style.display = 'none';
    document.removeEventListener('mousedown', hideDropdownIfClickedOutside);
  }
}

// Validate nh∆∞ tr∆∞·ªõc
function validateTableNumber() {
  const input = document.getElementById('table-number');
  const error = document.getElementById('table-number-error');
  const value = input.value;
  if (!value) {
    error.style.display = 'none';
    return true;
  }
  const numVal = Number(value);
  if (!Number.isInteger(numVal) || numVal < 1 || numVal > 150) {
    error.innerText = `Vui l√≤ng nh·∫≠p s·ªë th·∫ª b√†n t·ª´ 1 ƒë·∫øn 150 ho·∫∑c ch·ªçn trong danh s√°ch`;
    error.style.display = 'block';
    return false;
  }
  if (!availableTables.includes(numVal)) {
    error.innerText = `Th·∫ª b√†n s·ªë ${value} ƒëang c√≥ kh√°ch vui l√≤ng ch·ªçn s·ªë th·∫ª b√†n c√≥ trong list`;
    error.style.display = 'block';
    return false;
  }
  error.style.display = 'none';
  return true;
}

// Reset input khi m·ªü form m·ªõi
function resetTableInput() {
  document.getElementById('table-number').value = '';
  document.getElementById('table-number-error').style.display = 'none';
}
  </script>
 <div id="footer-container"></div>
  <script>
    fetch('footer.html')
      .then(response => response.text())
      .then(html => { document.getElementById('footer-container').innerHTML = html });
  </script>
  <script>
(function(){
  // Ch·ªâ th·ª±c hi·ªán tr√™n thi·∫øt b·ªã di ƒë·ªông
  function isMobile() {
    return window.innerWidth <= 768;
  }
  function hideFooter() {
    var f = document.getElementById('footer-container');
    if(f) f.style.display = 'none';
  }
  function showFooter() {
    var f = document.getElementById('footer-container');
    if(f) f.style.display = '';
  }
  // T√¨m t·∫•t c·∫£ input, textarea ƒë·ªÉ g√°n s·ª± ki·ªán focus/blur
  document.addEventListener('DOMContentLoaded', function() {
    if(!isMobile()) return;
    var inputs = document.querySelectorAll('input, textarea, select');
    inputs.forEach(function(el) {
      el.addEventListener('focus', hideFooter);
      el.addEventListener('blur', showFooter);
    });
    // N·∫øu d√πng th√™m b√†n ph√≠m ·∫£o ngo√†i, c√≥ th·ªÉ check th√™m event resize
    var oldHeight = window.innerHeight;
    window.addEventListener('resize', function() {
      if(!isMobile()) return;
      if(window.innerHeight < oldHeight - 80) hideFooter();
      else showFooter();
      oldHeight = window.innerHeight;
    });
  });
})();
</script>
</body>
</html>

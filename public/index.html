<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Coffee & Beer GooDjn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Reset & cơ bản */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Navbar Container */
    #navbar-container {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      background: #219a50;
      color: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.09);
      z-index: 10000;
      display: flex;
      flex-direction: column;
    }

    /* Navbar nội dung */
    nav.navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 12px;
      height: 56px;
    }

    /* Logo bên trái */
    .navbar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #fff200;
      font-weight: bold;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    .navbar-logo img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    /* Hotline bên phải */
    .navbar-hotline {
      background: white;
      color: #219a50;
      font-weight: 600;
      font-size: 0.9rem;
      border-radius: 20px;
      padding: 4px 10px;
      display: flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }
    .navbar-hotline svg {
      width: 18px;
      height: 18px;
      fill: #d32f2f;
    }

    /* Menu tabs Desktop/Tablet */
    .navbar-menu {
      display: flex;
      gap: 18px;
      font-weight: bold;
      font-size: 1rem;
      user-select: none;
    }
    .navbar-menu a {
      color: white;
      text-decoration: none;
      cursor: pointer;
      padding: 6px 4px;
      transition: background-color 0.2s ease;
      border-radius: 4px;
    }
    .navbar-menu a:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Hamburger menu button (Mobile) */
    .hamburger-btn {
      display: none;
      cursor: pointer;
      width: 30px;
      height: 24px;
      flex-direction: column;
      justify-content: space-between;
    }
    .hamburger-btn span {
      display: block;
      height: 3.5px;
      background: white;
      border-radius: 2px;
    }

    /* Mobile menu slide-down */
    #mobile-menu {
      display: none;
      flex-direction: column;
      background: #219a50;
      padding: 8px 12px;
    }
    #mobile-menu a {
      padding: 10px 8px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      text-decoration: none;
      user-select: none;
    }
    #mobile-menu a:last-child {
      border-bottom: none;
    }
    #mobile-menu a:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Marquee text */
    .marquee-flex-wrap {
      width: 100%;
      overflow: hidden;
      background: transparent;
      margin: 72px 0 15px 0; /* cách navbar cao 56 + padding */
      height: 2.2em;
      position: relative;
    }
    .marquee-flex-text {
      display: inline-block;
      white-space: nowrap;
      font-size: 1.3em;
      color: #08810a;
      font-weight: bold;
      animation: slide-right 15s linear infinite;
    }
    @keyframes slide-right {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100vw);
      }
    }

    /* Sản phẩm */
    #products {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 0 12px 24px 12px;
      box-sizing: border-box;
    }
    .product-card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      max-width: 260px;
      width: 100%;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
      cursor: pointer;
      user-select: none;
      transition: transform 0.15s ease-in-out;
    }
    .product-card:hover:not(.disabled) {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .product-card.disabled {
      opacity: 0.6;
      pointer-events: none;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    .product-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 6px;
    }
    .product-card > div {
      margin-top: 8px;
      font-weight: bold;
      font-size: 20px;
      color: #222;
    }
    .full-note {
      color: #d32f2f;
      font-weight: bold;
      font-size: 15px;
      margin-top: 5px;
    }

    /* Footer */
    #footer-container {
      width: 100vw;
      background: #219a50;
      color: white;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
      flex-shrink: 0;
      font-size: 14px;
      padding: 12px 10px;
      text-align: center;
      user-select: none;
    }
    #footer-container b {
      font-weight: 700;
    }

    /* Floating buttons */
    #floating-cart {
      position: fixed;
      top: 140px;
      right: 10px;
      background-color: #28a745;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      z-index: 9999;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    #scrollToTopBtn {
      position: fixed;
      bottom: 20px;
      right: 10px;
      background-color: red;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 6px;
      font-size: 18px;
      line-height: 30px;
      text-align: center;
      cursor: pointer;
      display: none;
      z-index: 9999;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    /* Search bar */
    #search-bar-area {
      position: fixed;
      right: 10px;
      top: 90px;
      z-index: 10002;
      display: flex;
      align-items: center;
      flex-direction: row;
      gap: 0;
    }
    #search-bar-area.hide {
      display: none !important;
    }
    #search-fab {
      width: 28px;
      height: 28px;
      background: #fff;
      color: #219a50;
      border: 2px solid #219a50;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 1px 8px rgba(0,0,0,0.13);
      transition: background 0.2s, color 0.2s;
      margin-bottom: 0;
      margin-right: 3px;
    }
    #search-fab:hover {
      background: #219a50;
      color: #fff;
    }
    #search-bar-wrapper {
      display: none;
      align-items: center;
      flex-direction: row;
      gap: 0;
      position: relative;
      z-index: 10003;
    }
    #search-bar {
      width: 175px;
      background: #fff;
      border: 1.8px solid #28a745;
      border-radius: 7px 0 0 7px;
      padding: 6px 10px;
      outline: none;
      font-size: 15px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.09);
      border-right: none;
    }
    #search-close {
      border: 1.8px solid #28a745;
      border-radius: 0 7px 7px 0;
      background: #f8d7da;
      color: #c82333;
      font-weight: bold;
      font-size: 15px;
      margin: 0;
      padding: 7px 13px 7px 9px;
      cursor: pointer;
      vertical-align: middle;
      border-left: none;
      transition: background 0.2s, color 0.2s;
      position: relative;
      left: -4px;
    }
    #search-close:hover {
      background: #c82333;
      color: #fff;
    }

    /* Media Queries for responsiveness */

    /* Mobile <600px */
    @media (max-width: 599px) {
      /* Navbar */
      nav.navbar {
        height: 48px;
        padding: 4px 8px;
        justify-content: flex-start;
      }
      .navbar-logo {
        font-size: 1rem;
      }
      .navbar-hotline {
        display: none; /* ẩn hotline vì không đủ chỗ */
      }
      .navbar-menu {
        display: none;
      }
      .hamburger-btn {
        display: flex;
        margin-right: 8px;
      }
      #mobile-menu {
        display: flex;
      }

      /* Products: 2 cột */
      #products {
        gap: 10px;
        margin: 0 6px 20px 6px;
      }
      .product-card {
        max-width: 48%;
        width: 48%;
      }
      .product-card img {
        height: 120px;
      }

      /* Footer font nhỏ */
      #footer-container {
        font-size: 12px;
        padding: 8px 8px;
        line-height: 1.3;
      }

      /* Search bar vị trí cao hơn */
      #search-bar-area {
        right: 6px;
        top: 70px;
      }
      #search-bar {
        width: 90px;
        font-size: 14px;
      }
    }

    /* Tablet: 600px - 900px */
    @media (min-width: 600px) and (max-width: 900px) {
      nav.navbar {
        height: 56px;
        padding: 6px 16px;
      }
      .navbar-hotline {
        display: flex;
      }
      .hamburger-btn {
        display: none;
      }
      .navbar-menu {
        display: flex;
        gap: 14px;
        font-size: 1rem;
      }
      #mobile-menu {
        display: none !important;
      }

      /* Products 4 cột */
      #products {
        gap: 12px;
        margin: 0 12px 24px 12px;
      }
      .product-card {
        max-width: 23%;
        width: 23%;
      }
      .product-card img {
        height: 130px;
      }

      /* Footer */
      #footer-container {
        font-size: 14px;
        padding: 12px 10px;
      }

      #search-bar-area {
        right: 10px;
        top: 90px;
      }
      #search-bar {
        width: 140px;
      }
    }

    /* Desktop >900px */
    @media (min-width: 901px) {
      nav.navbar {
        height: 64px;
        padding: 8px 24px;
      }
      .navbar-hotline {
        display: flex;
      }
      .hamburger-btn {
        display: none;
      }
      .navbar-menu {
        display: flex;
        gap: 18px;
        font-size: 1.1rem;
      }
      #mobile-menu {
        display: none !important;
      }

      /* Products 4 cột */
      #products {
        gap: 15px;
        margin: 0 24px 36px 24px;
      }
      .product-card {
        max-width: 260px;
        width: 100%;
      }
      .product-card img {
        height: 150px;
      }

      /* Footer */
      #footer-container {
        font-size: 14px;
        padding: 12px 10px;
      }

      #search-bar-area {
        right: 10px;
        top: 90px;
      }
      #search-bar {
        width: 175px;
      }
    }
  </style>
</head>
<body>
  <div id="navbar-container">
    <nav class="navbar">
      <!-- Hamburger menu icon for mobile -->
      <div class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle menu" role="button" tabindex="0">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="navbar-logo" aria-label="Logo Coffee & Beer DJ GooDjn">
        <img src="https://cdn-icons-png.flaticon.com/512/942/942801.png" alt="Logo" />
        Coffee & Beer DJ GooDjn
      </div>
      <div class="navbar-hotline" aria-label="Hotline">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M6.62 10.79a15.464 15.464 0 006.59 6.59l2.2-2.2a1 1 0 011.06-.27 11.36 11.36 0 003.58.57 1 1 0 011 1v3.75a1 1 0 01-1 1A16 16 0 014 6a1 1 0 011-1h3.75a1 1 0 011 1 11.36 11.36 0 00.57 3.58 1 1 0 01-.27 1.06l-2.43 2.15z" fill="#d32f2f"/>
        </svg>
        <span>Hotline: <a href="tel:0902926636" style="color:#219a50; font-weight:700; text-decoration:none;">0902 926 636</a></span>
      </div>
      <div class="navbar-menu" role="menubar" aria-label="Main menu">
        <a href="#dat-dich-vu" role="menuitem" tabindex="0">Đặt dịch vụ</a>
        <a href="#danh-gia-dich-vu" role="menuitem" tabindex="0">Đánh giá dịch vụ</a>
        <a href="#login" role="menuitem" tabindex="0">Login</a>
      </div>
    </nav>
    <!-- Mobile menu (ẩn mặc định) -->
    <div id="mobile-menu" role="menu" aria-label="Mobile menu">
      <a href="#dat-dich-vu" role="menuitem" tabindex="0" class="mobile-menu-link">Đặt dịch vụ</a>
      <a href="#danh-gia-dich-vu" role="menuitem" tabindex="0" class="mobile-menu-link">Đánh giá dịch vụ</a>
      <a href="#login" role="menuitem" tabindex="0" class="mobile-menu-link">Login</a>
    </div>
  </div>

  <div class="site-content" role="main" tabindex="-1">
    <div class="marquee-flex-wrap" aria-label="Chào mừng đến với Coffee & Beer DJ GooDjn">
      <div class="marquee-flex-text">
        Chào mừng đến với Coffee & Beer DJ GooDjn!
      </div>
    </div>

    <div id="products" aria-live="polite" aria-relevant="additions"></div>

    <!-- Modal đặt hàng - POPUP GIỎ HÀNG -->
    <!-- giữ nguyên modal cũ không thay đổi -->

    <div class="modal fade" id="modalOrder" tabindex="-1" role="dialog" aria-labelledby="modalOrderLabel" aria-hidden="true">
      <!-- ...modal content giữ nguyên như cũ... -->
    </div>

    <button id="floating-cart" onclick="showCartModal()" aria-label="Hiển thị giỏ hàng">
      Cart <span id="cart-count-floating" aria-live="polite" aria-atomic="true">0</span> 🛒
    </button>
    <button id="scrollToTopBtn" onclick="scrollToTop()" aria-label="Cuộn lên đầu trang">⬆</button>

    <!-- Search Bar UI -->
    <div id="search-bar-area">
      <div id="search-fab" title="Tìm kiếm" onclick="showSearchBar()" role="button" tabindex="0" aria-label="Hiển thị thanh tìm kiếm">
        <svg width="15" height="15" style="vertical-align:middle" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
          <circle cx="9" cy="9" r="6.5" stroke="#219a50" stroke-width="2" fill="none" />
          <line x1="14" y1="14" x2="19" y2="19" stroke="#219a50" stroke-width="2" stroke-linecap="round" />
        </svg>
      </div>
      <div id="search-bar-wrapper">
        <input id="search-bar" type="text" placeholder="Tìm Mã NV hoặc Ca LV..." autocomplete="off" aria-label="Tìm Mã NV hoặc Ca LV" oninput="searchProductHandler(this.value)" />
        <button id="search-close" onclick="closeSearchBar()" title="Xóa tìm kiếm" aria-label="Xóa tìm kiếm">✕</button>
      </div>
    </div>

    <!-- Modal chi tiết sản phẩm - POPUP SẢN PHẨM -->
    <div class="modal fade" id="modalProductDetail" tabindex="-1" style="display:none;">
      <div class="modal-dialog mt-4">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Chi tiết sản phẩm</h5>
            <button type="button" class="close" onclick="closeProductDetailModal()" aria-label="Đóng cửa sổ">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="modalProductDetailBody"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer-container" role="contentinfo"></div>

  <!-- Script phần Navbar, menu, và toggle hamburger menu -->
  <script>
    // Nạp navbar và footer nếu có file html riêng
    fetch('footer.html')
      .then(response => response.text())
      .then(html => { document.getElementById('footer-container').innerHTML = html; });

    // Toggle mobile menu
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const mobileMenu = document.getElementById('mobile-menu');

    hamburgerBtn.addEventListener('click', () => {
      if (mobileMenu.style.display === 'flex') {
        mobileMenu.style.display = 'none';
      } else {
        mobileMenu.style.display = 'flex';
      }
    });

    // Đóng menu khi chọn tab
    const mobileLinks = document.querySelectorAll('#mobile-menu .mobile-menu-link');
    mobileLinks.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.style.display = 'none';
      });
    });
  </script>

  <!-- Script chính cho chức năng sản phẩm, giỏ hàng giữ nguyên như bạn đã có -->
  <script>
    // Toàn bộ JavaScript bạn đã có trong file cũ, copy nguyên vẹn vào đây
    // Ví dụ:
    // function loadProducts() { ... }
    // function renderProducts() { ... }
    // ... tất cả các hàm khác ...

    // Tôi sẽ giữ nguyên code bạn đã có (vì quá dài), chỉ cần chèn lại phần này từ file cũ vào

    /* ==== BẮT ĐẦU MÃ JS CŨ ==== */
    let cart = [];
    let productsList = [];
    let employeeMap = {};
    let currentEmployeeMap = {};
    let lastSearchKey = "";
    let searchInputActive = false;
    let currentProductDetail = null;

    function formatCurrency(num) {
      return Number(num).toLocaleString('vi-VN') + "₫";
    }

    // --- Tự động reload sản phẩm sau mỗi 60s (để luôn cập nhật trạng thái mới nhất) ---
    let reloadProductsInterval = null;
    function startAutoReloadProducts() {
      if (reloadProductsInterval) clearInterval(reloadProductsInterval);
      reloadProductsInterval = setInterval(loadProducts, 60000);
    }

    async function loadProducts() {
      try {
        productsList = await fetch('/api/getProducts').then(r=>r.json());
        if (!Array.isArray(productsList) || productsList.length === 0) {
          document.getElementById('products').innerHTML = '<div style="color:red;text-align:center;width:100%;">Không lấy được dữ liệu sản phẩm! Hãy kiểm tra API hoặc dữ liệu Google Sheets!</div>';
          return;
        }
        employeeMap = groupByEmployee(productsList);
        currentEmployeeMap = employeeMap;
        renderProducts(currentEmployeeMap);
      } catch (e) {
        document.getElementById('products').innerHTML = '<div style="color:red;text-align:center;width:100%;">Lỗi lấy dữ liệu sản phẩm: ' + e + '</div>';
      }
    }

    function groupByEmployee(products) {
      const map = {};
      products.forEach(prod => {
        map[prod.maNV] = {
          linkAnhNV: prod.linkAnhNV || "",
          caList: prod.caList || [],
          isFull: prod.allCaFull || false
        };
      });
      return map;
    }

    function renderProducts(empMap) {
      const container = document.getElementById('products');
      let html = '';
      Object.entries(empMap).forEach(([maNV, emp]) => {
        let isFull = emp.caList.some(ca => ca.daFull === "Đã full");
        let cardClass = isFull ? "product-card disabled" : "product-card";
        html += `
          <div class="${cardClass}" id="card_${maNV}" style="cursor:${isFull ? 'not-allowed' : 'pointer'}" ${isFull ? '' : `onclick="showProductDetail('${maNV}')"`}>
            <img src="${emp.linkAnhNV && emp.linkAnhNV.length > 10 ? emp.linkAnhNV : 'https://via.placeholder.com/260x150?text=' + maNV}" alt="Ảnh sản phẩm">
            <div>${maNV}</div>
            ${isFull ? `<div class="full-note">Đã full</div>` : ""}
          </div>
        `;
      });
      container.innerHTML = html;
    }

    // Các hàm khác giữ nguyên như cũ (showProductDetail, popupCaCheckboxChange, addModalCheckedItems, ...)

    window.onload = () => {
      loadProducts();
      startAutoReloadProducts();
    };

    // Các hàm sự kiện, xử lý hiển thị modal, giỏ hàng, tìm kiếm ... giữ nguyên
    // ...

  </script>
</body>
</html>
Giải thích chính:
Thêm thanh navbar responsive, bao gồm logo, hotline, menu.

Ở Mobile (<600px), ẩn menu chính, hiện nút hamburger bên trái. Khi bấm sẽ bật menu thả xuống (menu mobile).

Ở Tablet (600-900px), hiện menu ngang, 4 cột sản phẩm.

Ở Desktop (>900px), menu đầy đủ, 4 cột sản phẩm.

Hình ảnh sản phẩm, các thẻ sản phẩm tự co giãn theo kích thước màn hình.

Giữ nguyên footer, modal, các button chức năng như cũ.

Đã tối ưu code CSS để đáp ứng chuẩn responsive cho từng kích thước thiết bị.

Đã bổ sung các thuộc tính ARIA giúp thân thiện với người dùng có trợ năng.

Nếu bạn cần, tôi có thể giúp bạn tách phần JavaScript riêng ra file .js để dễ quản lý, hoặc hỗ trợ chỉnh sửa thêm về UI/UX, hiệu ứng,...

Bạn có muốn tôi giúp upload file hoàn chỉnh này để bạn dễ copy không?






You said:
Tôi muốn bạn viết hoàn chỉnh file Index.html để tôi copy dán, (các đoạn  thêm vào hay giữ đoạn nào lại tôi không rành, tôi không phải lập trình viên)


ChatGPT said:
Dưới đây là file index.html hoàn chỉnh bạn có thể copy và dán trực tiếp vào Vercel, bao gồm:

Giao diện responsive Desktop, Tablet, Mobile theo đúng mẫu bạn gửi.

Thanh menu hamburger trên Mobile hoạt động đầy đủ.

Giữ nguyên các phần modal, giỏ hàng, tìm kiếm như bạn đã có.

Đã tích hợp đầy đủ CSS và JavaScript cần thiết bên trong 1 file duy nhất.

html
Copy
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Coffee & Beer GooDjn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Reset & cơ bản */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Navbar Container */
    #navbar-container {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      background: #219a50;
      color: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.09);
      z-index: 10000;
      display: flex;
      flex-direction: column;
    }

    /* Navbar nội dung */
    nav.navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 12px;
      height: 56px;
    }

    /* Logo bên trái */
    .navbar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #fff200;
      font-weight: bold;
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    .navbar-logo img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    /* Hotline bên phải */
    .navbar-hotline {
      background: white;
      color: #219a50;
      font-weight: 600;
      font-size: 0.9rem;
      border-radius: 20px;
      padding: 4px 10px;
      display: flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }
    .navbar-hotline svg {
      width: 18px;
      height: 18px;
      fill: #d32f2f;
    }

    /* Menu tabs Desktop/Tablet */
    .navbar-menu {
      display: flex;
      gap: 18px;
      font-weight: bold;
      font-size: 1rem;
      user-select: none;
    }
    .navbar-menu a {
      color: white;
      text-decoration: none;
      cursor: pointer;
      padding: 6px 4px;
      transition: background-color 0.2s ease;
      border-radius: 4px;
    }
    .navbar-menu a:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Hamburger menu button (Mobile) */
    .hamburger-btn {
      display: none;
      cursor: pointer;
      width: 30px;
      height: 24px;
      flex-direction: column;
      justify-content: space-between;
    }
    .hamburger-btn span {
      display: block;
      height: 3.5px;
      background: white;
      border-radius: 2px;
    }

    /* Mobile menu slide-down */
    #mobile-menu {
      display: none;
      flex-direction: column;
      background: #219a50;
      padding: 8px 12px;
    }
    #mobile-menu a {
      padding: 10px 8px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      text-decoration: none;
      user-select: none;
    }
    #mobile-menu a:last-child {
      border-bottom: none;
    }
    #mobile-menu a:hover {
      background: rgba(255,255,255,0.2);
    }

    /* Marquee text */
    .marquee-flex-wrap {
      width: 100%;
      overflow: hidden;
      background: transparent;
      margin: 72px 0 15px 0;
      height: 2.2em;
      position: relative;
    }
    .marquee-flex-text {
      display: inline-block;
      white-space: nowrap;
      font-size: 1.3em;
      color: #08810a;
      font-weight: bold;
      animation: slide-right 15s linear infinite;
    }
    @keyframes slide-right {
      0% {
        transform: translateX(-100%);
      }
      100% {
        transform: translateX(100vw);
      }
    }

    /* Sản phẩm */
    #products {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 0 12px 24px 12px;
      box-sizing: border-box;
    }
    .product-card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      max-width: 260px;
      width: 100%;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
      cursor: pointer;
      user-select: none;
      transition: transform 0.15s ease-in-out;
    }
    .product-card:hover:not(.disabled) {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .product-card.disabled {
      opacity: 0.6;
      pointer-events: none;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    .product-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 6px;
    }
    .product-card > div {
      margin-top: 8px;
      font-weight: bold;
      font-size: 20px;
      color: #222;
    }
    .full-note {
      color: #d32f2f;
      font-weight: bold;
      font-size: 15px;
      margin-top: 5px;
    }

    /* Footer */
    #footer-container {
      width: 100vw;
      background: #219a50;
      color: white;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
      flex-shrink: 0;
      font-size: 14px;
      padding: 12px 10px;
      text-align: center;
      user-select: none;
    }
    #footer-container b {
      font-weight: 700;
    }

    /* Floating buttons */
    #floating-cart {
      position: fixed;
      top: 140px;
      right: 10px;
      background-color: #28a745;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      z-index: 9999;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    #scrollToTopBtn {
      position: fixed;
      bottom: 20px;
      right: 10px;
      background-color: red;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 6px;
      font-size: 18px;
      line-height: 30px;
      text-align: center;
      cursor: pointer;
      display: none;
      z-index: 9999;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    /* Search bar */
    #search-bar-area {
      position: fixed;
      right: 10px;
      top: 90px;
      z-index: 10002;
      display: flex;
      align-items: center;
      flex-direction: row;
      gap: 0;
    }
    #search-bar-area.hide {
      display: none !important;
    }
    #search-fab {
      width: 28px;
      height: 28px;
      background: #fff;
      color: #219a50;
      border: 2px solid #219a50;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 1px 8px rgba(0,0,0,0.13);
      transition: background 0.2s, color 0.2s;
      margin-bottom: 0;
      margin-right: 3px;
    }
    #search-fab:hover {
      background: #219a50;
      color: #fff;
    }
    #search-bar-wrapper {
      display: none;
      align-items: center;
      flex-direction: row;
      gap: 0;
      position: relative;
      z-index: 10003;
    }
    #search-bar {
      width: 175px;
      background: #fff;
      border: 1.8px solid #28a745;
      border-radius: 7px 0 0 7px;
      padding: 6px 10px;
      outline: none;
      font-size: 15px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.09);
      border-right: none;
    }
    #search-close {
      border: 1.8px solid #28a745;
      border-radius: 0 7px 7px 0;
      background: #f8d7da;
      color: #c82333;
      font-weight: bold;
      font-size: 15px;
      margin: 0;
      padding: 7px 13px 7px 9px;
      cursor: pointer;
      vertical-align: middle;
      border-left: none;
      transition: background 0.2s, color 0.2s;
      position: relative;
      left: -4px;
    }
    #search-close:hover {
      background: #c82333;
      color: #fff;
    }

    /* Media Queries for responsiveness */

    /* Mobile <600px */
    @media (max-width: 599px) {
      /* Navbar */
      nav.navbar {
        height: 48px;
        padding: 4px 8px;
        justify-content: flex-start;
      }
      .navbar-logo {
        font-size: 1rem;
      }
      .navbar-hotline {
        display: none; /* ẩn hotline vì không đủ chỗ */
      }
      .navbar-menu {
        display: none;
      }
      .hamburger-btn {
        display: flex;
        margin-right: 8px;
      }
      #mobile-menu {
        display: none;
        flex-direction: column;
        background: #219a50;
        padding: 8px 12px;
        position: absolute;
        top: 48px;
        left: 0;
        width: 100%;
        box-sizing: border-box;
        z-index: 11000;
      }
      #mobile-menu.show {
        display: flex;
      }

      /* Products: 2 cột */
      #products {
        gap: 10px;
        margin: 0 6px 20px 6px;
      }
      .product-card {
        max-width: 48%;
        width: 48%;
      }
      .product-card img {
        height: 120px;
      }

      /* Footer font nhỏ */
      #footer-container {
        font-size: 12px;
        padding: 8px 8px;
        line-height: 1.3;
      }

      /* Search bar vị trí cao hơn */
      #search-bar-area {
        right: 6px;
        top: 70px;
      }
      #search-bar {
        width: 90px;
        font-size: 14px;
      }
    }

    /* Tablet: 600px - 900px */
    @media (min-width: 600px) and (max-width: 900px) {
      nav.navbar {
        height: 56px;
        padding: 6px 16px;
      }
      .navbar-hotline {
        display: flex;
      }
      .hamburger-btn {
        display: none;
      }
      .navbar-menu {
        display: flex;
        gap: 14px;
        font-size: 1rem;
      }
      #mobile-menu {
        display: none !important;
      }

      /* Products 4 cột */
      #products {
        gap: 12px;
        margin: 0 12px 24px 12px;
      }
      .product-card {
        max-width: 23%;
        width: 23%;
      }
      .product-card img {
        height: 130px;
      }

      /* Footer */
      #footer-container {
        font-size: 14px;
        padding: 12px 10px;
      }

      #search-bar-area {
        right: 10px;
        top: 90px;
      }
      #search-bar {
        width: 140px;
      }
    }

    /* Desktop >900px */
    @media (min-width: 901px) {
      nav.navbar {
        height: 64px;
        padding: 8px 24px;
      }
      .navbar-hotline {
        display: flex;
      }
      .hamburger-btn {
        display: none;
      }
      .navbar-menu {
        display: flex;
        gap: 18px;
        font-size: 1.1rem;
      }
      #mobile-menu {
        display: none !important;
      }

      /* Products 4 cột */
      #products {
        gap: 15px;
        margin: 0 24px 36px 24px;
      }
      .product-card {
        max-width: 260px;
        width: 100%;
      }
      .product-card img {
        height: 150px;
      }

      /* Footer */
      #footer-container {
        font-size: 14px;
        padding: 12px 10px;
      }

      #search-bar-area {
        right: 10px;
        top: 90px;
      }
      #search-bar {
        width: 175px;
      }
    }
  </style>
</head>
<body>
  <div id="navbar-container">
    <nav class="navbar" role="navigation" aria-label="Thanh điều hướng chính">
      <!-- Hamburger menu icon for mobile -->
      <div class="hamburger-btn" id="hamburgerBtn" aria-label="Mở menu" role="button" tabindex="0">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="navbar-logo" aria-label="Logo Coffee & Beer DJ GooDjn">
        <img src="https://cdn-icons-png.flaticon.com/512/942/942801.png" alt="Logo" />
        Coffee & Beer DJ GooDjn
      </div>
      <div class="navbar-hotline" aria-label="Hotline">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg">
          <path d="M6.62 10.79a15.464 15.464 0 006.59 6.59l2.2-2.2a1 1 0 011.06-.27 11.36 11.36 0 003.58.57 1 1 0 011 1v3.75a1 1 0 01-1 1A16 16 0 014 6a1 1 0 011-1h3.75a1 1 0 011 1 11.36 11.36 0 00.57 3.58 1 1 0 01-.27 1.06l-2.43 2.15z" fill="#d32f2f"/>
        </svg>
        <span>Hotline: <a href="tel:0902926636" style="color:#219a50; font-weight:700; text-decoration:none;">0902 926 636</a></span>
      </div>
      <div class="navbar-menu" role="menubar" aria-label="Menu chính">
        <a href="#dat-dich-vu" role="menuitem" tabindex="0">Đặt dịch vụ</a>
        <a href="#danh-gia-dich-vu" role="menuitem" tabindex="0">Đánh giá dịch vụ</a>
        <a href="#login" role="menuitem" tabindex="0">Login</a>
      </div>
    </nav>
    <!-- Mobile menu -->
    <div id="mobile-menu" role="menu" aria-label="Menu di động">
      <a href="#dat-dich-vu" role="menuitem" tabindex="0" class="mobile-menu-link">Đặt dịch vụ</a>
      <a href="#danh-gia-dich-vu" role="menuitem" tabindex="0" class="mobile-menu-link">Đánh giá dịch vụ</a>
      <a href="#login" role="menuitem" tabindex="0" class="mobile-menu-link">Login</a>
    </div>
  </div>

  <div class="site-content" role="main" tabindex="-1">
    <div class="marquee-flex-wrap" aria-label="Chào mừng đến với Coffee & Beer DJ GooDjn">
      <div class="marquee-flex-text">
        Chào mừng đến với Coffee & Beer DJ GooDjn!
      </div>
    </div>

    <div id="products" aria-live="polite" aria-relevant="additions"></div>

    <!-- Modal đặt hàng - giữ nguyên modal cũ của bạn -->
    <div class="modal fade" id="modalOrder" tabindex="-1" role="dialog" aria-labelledby="modalOrderLabel" aria-hidden="true">
      <div class="modal-dialog mt-4">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalOrderLabel">ĐẶT DỊCH VỤ</h5>
            <button type="button" class="close" onclick="closeCartModal()" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div id="order-thankyou"></div>
            <div class="alert alert-danger" role="alert" id="alert_order"></div>
            <div class="alert alert-success" role="alert" id="alert_order_sucess"></div>
            <table id="tbl_carts" style="table-layout: fixed; width: 100%;">
            <thead>
              <tr>
              <th style="width: 20%;">Mã NV</th>
              <th style="width: 25%;">Đơn giá</th>
              <th style="width: 15%;">Ca LV</th>
              <th style="width: 25%;">Tổng</th>
              <th style="width: 15%;">Xóa</th>
              </tr>
            </thead>
              <tbody>
              </tbody>
            </table>
            <div id="order-total" style="text-align:right; font-weight:bold; margin-bottom:10px;"></div>
            <input placeholder="Họ và tên" id="name"><br>
            <input placeholder="Số điện thoại" id="phone" maxlength="10" pattern="[0-9]{10}" oninput="validatePhoneInput(this)"><br>
            <input placeholder="Email" id="contact"><br>
            <input placeholder="Bàn số 1-50" id="table-number" type="number" min="1" max="50"><br>
            <textarea placeholder="Ghi chú" id="address"></textarea><br><br>
            <div class="form-buttons">
              <button class="confirm-btn" onclick="submitOrder()">Đặt dịch vụ</button>
              <button class="close-btn" onclick="closeCartModal()">Đóng</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button id="floating-cart" onclick="showCartModal()" aria-label="Hiển thị giỏ hàng">
      Cart <span id="cart-count-floating" aria-live="polite" aria-atomic="true">0</span> 🛒
    </button>
    <button id="scrollToTopBtn" onclick="scrollToTop()" aria-label="Cuộn lên đầu trang">⬆</button>

    <!-- Search Bar UI -->
    <div id="search-bar-area">
      <div id="search-fab" title="Tìm kiếm" onclick="showSearchBar()" role="button" tabindex="0" aria-label="Hiển thị thanh tìm kiếm">
        <svg width="15" height="15" style="vertical-align:middle" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
          <circle cx="9" cy="9" r="6.5" stroke="#219a50" stroke-width="2" fill="none" />
          <line x1="14" y1="14" x2="19" y2="19" stroke="#219a50" stroke-width="2" stroke-linecap="round" />
        </svg>
      </div>
      <div id="search-bar-wrapper">
        <input id="search-bar" type="text" placeholder="Tìm Mã NV hoặc Ca LV..." autocomplete="off" aria-label="Tìm Mã NV hoặc Ca LV" oninput="searchProductHandler(this.value)" />
        <button id="search-close" onclick="closeSearchBar()" title="Xóa tìm kiếm" aria-label="Xóa tìm kiếm">✕</button>
      </div>
    </div>

    <!-- Modal chi tiết sản phẩm -->
    <div class="modal fade" id="modalProductDetail" tabindex="-1" style="display:none;">
      <div class="modal-dialog mt-4">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Chi tiết sản phẩm</h5>
            <button type="button" class="close" onclick="closeProductDetailModal()" aria-label="Đóng cửa sổ">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="modalProductDetailBody"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer-container" role="contentinfo"></div>

  <script>
    // Nạp footer (nếu bạn có file footer.html)
    fetch('footer.html')
      .then(response => response.text())
      .then(html => { document.getElementById('footer-container').innerHTML = html; });

    // Toggle mobile menu
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const mobileMenu = document.getElementById('mobile-menu');

    hamburgerBtn.addEventListener('click', () => {
      if (mobileMenu.classList.contains('show')) {
        mobileMenu.classList.remove('show');
      } else {
        mobileMenu.classList.add('show');
      }
    });

    // Đóng menu khi chọn tab mobile
    const mobileLinks = document.querySelectorAll('#mobile-menu .mobile-menu-link');
    mobileLinks.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.remove('show');
      });
    });

    // Phần JavaScript hiện tại bạn có, tôi giữ nguyên và chèn vào đây:

    let cart = [];
    let productsList = [];
    let employeeMap = {};
    let currentEmployeeMap = {};
    let lastSearchKey = "";
    let searchInputActive = false;
    let currentProductDetail = null;

    function formatCurrency(num) {
      return Number(num).toLocaleString('vi-VN') + "₫";
    }

    let reloadProductsInterval = null;
    function startAutoReloadProducts() {
      if (reloadProductsInterval) clearInterval(reloadProductsInterval);
      reloadProductsInterval = setInterval(loadProducts, 60000);
    }

    async function loadProducts() {
      try {
        productsList = await fetch('/api/getProducts').then(r=>r.json());
        if (!Array.isArray(productsList) || productsList.length === 0) {
          document.getElementById('products').innerHTML = '<div style="color:red;text-align:center;width:100%;">Không lấy được dữ liệu sản phẩm! Hãy kiểm tra API hoặc dữ liệu Google Sheets!</div>';
          return;
        }
        employeeMap = groupByEmployee(productsList);
        currentEmployeeMap = employeeMap;
        renderProducts(currentEmployeeMap);
      } catch (e) {
        document.getElementById('products').innerHTML = '<div style="color:red;text-align:center;width:100%;">Lỗi lấy dữ liệu sản phẩm: ' + e + '</div>';
      }
    }

    function groupByEmployee(products) {
      const map = {};
      products.forEach(prod => {
        map[prod.maNV] = {
          linkAnhNV: prod.linkAnhNV || "",
          caList: prod.caList || [],
          isFull: prod.allCaFull || false
        };
      });
      return map;
    }

    function renderProducts(empMap) {
      const container = document.getElementById('products');
      let html = '';
      Object.entries(empMap).forEach(([maNV, emp]) => {
        let isFull = emp.caList.some(ca => ca.daFull === "Đã full");
        let cardClass = isFull ? "product-card disabled" : "product-card";
        html += `
          <div class="${cardClass}" id="card_${maNV}" style="cursor:${isFull ? 'not-allowed' : 'pointer'}" ${isFull ? '' : `onclick="showProductDetail('${maNV}')"`}>
            <img src="${emp.linkAnhNV && emp.linkAnhNV.length > 10 ? emp.linkAnhNV : 'https://via.placeholder.com/260x150?text=' + maNV}" alt="Ảnh sản phẩm">
            <div>${maNV}</div>
            ${isFull ? `<div class="full-note">Đã full</div>` : ""}
          </div>
        `;
      });
      container.innerHTML = html;
    }

    function isCaInCart(maNV, caLV) {
      return cart.some(item => item.maNV === maNV && item.caLV === caLV);
    }

    function showProductDetail(maNV) {
      currentProductDetail = maNV;
      const emp = currentEmployeeMap[maNV];
      if (!emp) return;
      window._popupTempChecked = {};

      let html = `
        <div style="text-align:center;">
          <img src="${emp.linkAnhNV && emp.linkAnhNV.length > 10 ? emp.linkAnhNV : 'https://via.placeholder.com/180x140?text=' + maNV}" alt="Ảnh sản phẩm" style="width:180px;height:140px;object-fit:cover;border-radius:8px;">
          <div style="font-weight:bold; font-size:22px; margin-top:12px;">${maNV}</div>
        </div>
        <ul class="ca-list" style="margin-top:18px;">
      `;
      emp.caList.forEach((ca, idx) => {
        if (ca.trangThai !== "Làm việc") return;
        const idCheckbox = `modal_ck_${maNV}_${ca.caLV}`;
        const isLocked = isCaInCart(maNV, ca.caLV);
        const isBusy = ca.dangBan === "Đang bận";
        html += `
          <li class="ca-item-row" data-ma-nv="${maNV}" data-ca-lv="${ca.caLV}">
            <span class="ca-label">Ca ${ca.caLV}:</span>
            <span class="ca-price">${formatCurrency(ca.donGia)}</span>
            <input type="checkbox" class="ca-checkbox" id="${idCheckbox}" 
              data-ma-nv="${maNV}" data-ca-lv="${ca.caLV}" data-don-gia="${ca.donGia}"
              ${isLocked ? "checked disabled" : ""}
              ${isBusy ? "disabled" : ""}
              onchange="popupCaCheckboxChange(this)">
            ${isBusy ? `<span class="ca-busy-note">Đang bận việc</span>` : ""}
            <button class="ca-remove-btn2" onclick="removeCaFromCartModal('${maNV}','${ca.caLV}')" style="${isLocked ? '' : 'display:none'};margin-left:7px;">Xóa</button>
            ${isLocked ? `<span class="note-already-added" style="margin-left:7px;">Ca ${ca.caLV} đã có trong giỏ hàng</span>` : ""}
          </li>
        `;
      });

      html += `</ul>
        <div class="form-buttons" style="margin-top:24px;">
          <button class="confirm-btn" onclick="addModalCheckedItems('${maNV}')">Thêm vào giỏ</button>
          <button class="close-btn" onclick="closeProductDetailModal()">Đóng</button>
        </div>
      `;

      document.getElementById('modalProductDetailBody').innerHTML = html;
      document.getElementById('modalProductDetail').classList.add('show');
      document.getElementById('modalProductDetail').style.display = 'block';
      window._popupTempChecked = {};
    }

    function popupCaCheckboxChange(cb) {
      const maNV = cb.getAttribute('data-ma-nv');
      const caLV = cb.getAttribute('data-ca-lv');
      if (cb.disabled) return;
      window._popupTempChecked = window._popupTempChecked || {};
      window._popupTempChecked[caLV] = cb.checked;
    }

    function addModalCheckedItems(maNV) {
      window._popupTempChecked = window._popupTempChecked || {};
      const emp = currentEmployeeMap[maNV];
      if (!emp) return;
      let isAdded = false;
      emp.caList.forEach((ca) => {
        if (ca.trangThai !== "Làm việc") return;
        if (window._popupTempChecked[ca.caLV] && !isCaInCart(maNV, ca.caLV)) {
          cart.push({ maNV, caLV: ca.caLV, donGia: ca.donGia });
          isAdded = true;
        }
      });
      showProductDetail(maNV);
      updateCartCount();
    }

    function removeCaFromCartModal(maNV, caLV) {
      const idx = cart.findIndex(item => item.maNV === maNV && item.caLV === caLV);
      if (idx !== -1) cart.splice(idx, 1);
      showProductDetail(maNV);
      updateCartCount();
    }

    function closeProductDetailModal() {
      document.getElementById('modalProductDetail').classList.remove('show');
      document.getElementById('modalProductDetail').style.display = 'none';
      currentProductDetail = null;
    }

    function refreshProductDetailIfOpen() {
      if (currentProductDetail && document.getElementById('modalProductDetail').style.display === 'block') {
        showProductDetail(currentProductDetail);
      }
    }

    function updateCartCount() {
      document.getElementById('cart-count-floating').innerText = cart.length;
    }

    function removeFromCart(index) {
      if (index >= 0 && index < cart.length) {
        cart.splice(index, 1);
        renderCartTable();
        updateCartCount();
        refreshProductDetailIfOpen();
      }
    }

    function renderCartTable() {
      const tbody = document.querySelector('#tbl_carts tbody');
      tbody.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
        const sub = item.donGia;
        total += sub;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.maNV}</td>
          <td>${formatCurrency(item.donGia)}</td>
          <td>${item.caLV}</td>
          <td>${formatCurrency(sub)}</td>
          <td><button class="remove-cart-btn" title="Remove" onclick="removeFromCart(${index})">🗑️</button></td>
        `;
        tbody.appendChild(row);
      });
      document.getElementById('order-total').innerHTML = "Tổng cộng: " + formatCurrency(total);
    }

    function showCartModal() {
      renderCartTable();
      document.getElementById('alert_order').style.display = 'none';
      document.getElementById('alert_order_sucess').style.display = 'none';
      document.getElementById('order-thankyou').style.display = 'none';
      document.getElementById('modalOrder').classList.add('show');
      document.getElementById('modalOrder').style.display = 'block';
      document.getElementById('floating-cart').style.display = 'none';
      document.getElementById('scrollToTopBtn').style.display = 'none';
      document.getElementById('search-bar-area').classList.add('hide');
      closeSearchBar();
    }

    function closeCartModal() {
      document.getElementById('modalOrder').classList.remove('show');
      document.getElementById('modalOrder').style.display = 'none';
      document.getElementById('floating-cart').style.display = '';
      document.getElementById('search-bar-area').classList.remove('hide');
      if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
        document.getElementById('scrollToTopBtn').style.display = 'block';
      } else {
        document.getElementById('scrollToTopBtn').style.display = 'none';
      }
    }

    function validatePhoneInput(input) {
      input.value = input.value.replace(/[^0-9]/g, '').slice(0, 10);
    }

    async function submitOrder() {
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const contact = document.getElementById('contact').value.trim();
      const address = document.getElementById('address').value.trim();
      const tableNum = document.getElementById('table-number').value.trim();
      const alertOrder = document.getElementById('alert_order');
      const alertSuccess = document.getElementById('alert_order_sucess');
      const orderThankyou = document.getElementById('order-thankyou');

      alertOrder.style.display = 'none';
      alertSuccess.style.display = 'none';
      orderThankyou.style.display = 'none';

      if (!name || !phone || !contact || !tableNum || !address) {
        alertOrder.innerText = "Vui lòng điền đầy đủ Họ và tên, Số điện thoại, Email, Số bàn, Ghi chú";
        alertOrder.style.display = 'block';
        return;
      }
      if (!/^[0-9]{10}$/.test(phone)) {
        alertOrder.innerText = "Số điện thoại phải gồm đúng 10 số.";
        alertOrder.style.display = 'block';
        return;
      }
      if (cart.length === 0) {
        alertOrder.innerText = "Giỏ hàng trống chưa có sản phẩm!";
        alertOrder.style.display = 'block';
        return;
      }

      const order = { name, phone, contact, address, tableNum, items: cart };

      try {
        const result = await fetch('/api/submitOrder', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(order)
        }).then(r => r.json());

        if (result && result.success) {
          alertOrder.style.display = 'none';
          alertSuccess.style.display = 'none';
          orderThankyou.innerText = `Đơn hàng ${result.orderCode} của bạn đã gửi đến GooDjn DJ Coffee & Beer, cảm ơn bạn!`;
          orderThankyou.style.display = 'block';
          cart = [];
          document.getElementById('cart-count-floating').innerText = '0';
          setTimeout(() => {
            closeCartModal();
            renderProducts(currentEmployeeMap);
            orderThankyou.style.display = 'none';
            refreshProductDetailIfOpen();
          }, 2000);
        } else {
          alertOrder.innerText = "Có lỗi xảy ra khi gửi đơn hàng. Vui lòng thử lại.";
          alertOrder.style.display = 'block';
        }
      } catch (e) {
        alertOrder.innerText = "Lỗi kết nối: " + e;
        alertOrder.style.display = 'block';
      }
    }

    window.onscroll = function () {
      const btn = document.getElementById("scrollToTopBtn");
      if (btn) {
        btn.style.display = (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) ? "block" : "none";
      }
    };

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showSearchBar() {
      document.getElementById('search-bar-wrapper').style.display = 'flex';
      document.getElementById('search-bar').focus();
    }

    function closeSearchBar() {
      document.getElementById('search-bar-wrapper').style.display = 'none';
      document.getElementById('search-bar').value = '';
      searchInputActive = false;
      applyProductSearchFilter('');
    }

    function searchProductHandler(val) {
      val = val || "";
      searchInputActive = val.trim().length > 0;
      applyProductSearchFilter(val);
    }

    function applyProductSearchFilter(keyword) {
      lastSearchKey = keyword = (keyword || "").trim().toLowerCase();
      if (!keyword) {
        currentEmployeeMap = employeeMap;
      } else {
        let filteredEmployeeMap = {};
        let caMatchList = [];
        const caRegex = /ca\s*([0-9]+)/g;
        let m;
        while ((m = caRegex.exec(keyword)) !== null) {
          caMatchList.push(m[1].replace(/^0+/, ''));
        }
        keyword = keyword.replace(/ca\s*[0-9]+/g, "");
        keyword = keyword.trim();

        Object.entries(employeeMap).forEach(([maNV, emp]) => {
          const matchNV = keyword && maNV.toLowerCase().includes(keyword);
          let caList = emp.caList;
          if (caMatchList.length > 0) {
            caList = caList.filter(
              ca => caMatchList.includes(ca.caLV.replace(/^0+/, ""))
            );
          }
          if (keyword) {
            caList = caList.filter(
              ca =>
                matchNV ||
                maNV.toLowerCase().includes(keyword) ||
                ca.caLV.toLowerCase().includes(keyword)
            );
          }
          if (matchNV || caList.length) {
            filteredEmployeeMap[maNV] = {
              linkAnhNV: emp.linkAnhNV,
              caList,
              isFull: emp.isFull
            };
          }
        });
        currentEmployeeMap = filteredEmployeeMap;
      }
      renderProducts(currentEmployeeMap);
    }

    window.applyProductSearchFilter = applyProductSearchFilter;
    window.popupCaCheckboxChange = popupCaCheckboxChange;
    window.removeCaFromCartModal = removeCaFromCartModal;
    window.addModalCheckedItems = addModalCheckedItems;
    window.showProductDetail = showProductDetail;
    window.closeProductDetailModal = closeProductDetailModal;
    window.removeFromCart = removeFromCart;
    window.showCartModal = showCartModal;
    window.closeCartModal = closeCartModal;
    window.submitOrder = submitOrder;
    window.scrollToTop = scrollToTop;
    window.validatePhoneInput = validatePhoneInput;
    window.showSearchBar = showSearchBar;
    window.closeSearchBar = closeSearchBar;
    window.searchProductHandler = searchProductHandler;
    window.refreshProductDetailIfOpen = refreshProductDetailIfOpen;

    window.onload = () => {
      loadProducts();
      startAutoReloadProducts();
    };

    document.addEventListener('click', function (e) {
      const fab = document.getElementById('search-fab');
      const wrapper = document.getElementById('search-bar-wrapper');
      if (wrapper && wrapper.style.display === 'flex' && !wrapper.contains(e.target) && !fab.contains(e.target)) {
        if (!document.getElementById('search-bar').value.trim()) {
          closeSearchBar();
        }
      }
    });
  </script>
</body>
</html>
